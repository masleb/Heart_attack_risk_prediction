# Предсказание рисков сердечного приступа

## Описание проекта

В этом проекте необходимо было разработать модель для предсказания риска сердечного приступа, используя данные пациентов (датасет из открытого источника), такие как возраст, привычки, состояние здоровья и результаты анализа крови. 

В ходе исследования была проведена предобработка данных, EDA, поиск лучшей модели. 

С помощью GridSearch были обучены модели CatBoostClassifier() и RandomForestClassifier() c разными гиперпараметрами. Для устранения дисбаланса в целевом признаке был использован RandomUnderSampler. 

В итоге была выбрана лучшая модель, которая используется в приложении для получения предсказаний.

См. тетрадку Heart_attack_risk_prediction.ipynb (зависимости для неё в `requirements_jupyter_notebook.txt`).

### Установка зависимостей для тетрадки

```
pip install -r Heart_attack_risk_prediction.ipynb
```

## Описание приложения

Для формирования самих предсказаний с помощью обученной модели написано API-приложение на фреймворке [FastAPI](https://fastapi.tiangolo.com/#installation).

В приложении создан класс `ModelObject`, у которого доступен метод `prediction`, принимающий на вход имя файла с данными, которые нужно прочитать и составить по нему предсказания. Для этого мне понадобилось создать несколько внутренних методов для чтения файла в csv-формате (`__read_data`), предобработки данных (`__prepare_data`) и формирование датасета, подготовленного для предсказаний (`__prepare_result`).


### Установка зависимостей для приложения

```
pip install -r requirements.txt
```

### Запуск приложения

```
python main.py
```

### Использование приложения

```
$ curl localhost:8000/
{
  "app": "Heart Attack Risk Prediction System (API)",
  "endpoints": {
    "GET /health": "состояние приложения",
    "POST /process": "отправка файла с данными для предсказания"
  }
}
```

#### GET /health

Метод для проверки состояния приложения

```
$ curl localhost:8000/health
{
  "status": "OK",
  "message": "Модель загружена"
}
```

#### POST /process

Этот метод принимает на вход файл в .csv-формате и возвращает результат в JSON-формате:

```
$ curl -X POST -F "file=@data/heart_test.csv" localhost:8000/process
{
  "result": "success",
  "message": "",
  "data": [
    {"id": <id>,"prediction":<prediction>},
    ...
  ]
}
```

`<id>` в данном выводе указывает на конкретную строчку с этим id, а `<prediction>` - результат предсказания: "низкий риск". "высокий риск" или же "недостаточно данных для предсказания", если невозможно дать предсказание по данным из этой строки.